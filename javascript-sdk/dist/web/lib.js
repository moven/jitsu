!function(){"use strict";var e=function(){return e=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},e.apply(this,arguments)};function t(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))}function n(e,t){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}function o(e,t,n){if(n||2===arguments.length)for(var o,i=0,r=t.length;i<r;i++)!o&&i in t||(o||(o=Array.prototype.slice.call(t,0,i)),o[i]=t[i]);return e.concat(o||Array.prototype.slice.call(t))}function i(e){let t=!!globalThis.window.location;return!t&&e&&c().warn(e),t}function r(e){if(!i())throw new Error(e||"window' is not available. Seems like this code runs outside browser environment. It shouldn't happen");return window}var s={DEBUG:{name:"DEBUG",severity:10},INFO:{name:"INFO",severity:100},WARN:{name:"WARN",severity:1e3},ERROR:{name:"ERROR",severity:1e4},NONE:{name:"NONE",severity:1e4}},a=null;function c(){return a||(a=u())}function u(e){var t=i()&&window.__eventNLogLevel,n=s.WARN;if(t){var r=s[t.toUpperCase()];r&&r>0&&(n=r)}else e&&(n=e);var a={minLogLevel:n};return Object.values(s).forEach((function(e){var t=e.name,i=e.severity;a[t.toLowerCase()]=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(i>=n.severity&&e.length>0){var s=e[0],a=e.splice(1),c="[J-".concat(t,"] ").concat(s);"DEBUG"===t||"INFO"===t?console.log.apply(console,o([c],a,!1)):"WARN"===t?console.warn.apply(console,o([c],a,!1)):console.error.apply(console,o([c],a,!1))}}})),function(e,t){if(i()){var n=window;n.__jitsuDebug||(n.__jitsuDebug={}),n.__jitsuDebug[e]=t}}("logger",a),a}function l(e,t,n){void 0===n&&(n={});var o=e+"="+encodeURIComponent(t);if(n.maxAge&&(o+="; Max-Age="+Math.floor(n.maxAge)),n.domain&&(o+="; Domain="+n.domain),n.path&&(o+="; Path="+n.path),n.expires&&(o+="; Expires="+n.expires.toUTCString()),n.httpOnly&&(o+="; HttpOnly"),n.secure&&(o+="; Secure"),n.sameSite)switch("string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return o}var p;function d(e){if(!e)return{};for(var t={},n=e.split(";"),o=0;o<n.length;o++){var i=n[o],r=i.indexOf("=");r>0&&(t[i.substr(o>0?1:0,o>0?r-1:r)]=i.substr(r+1))}return t}var h=function(e){return e&&decodeURIComponent(r().document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},f=function(e,t,n){void 0===n&&(n={}),r().document.cookie=l(e,t,n)},m=function(e){document.cookie=e+"= ; expires = Thu, 01 Jan 1970 00:00:00 GMT"},v=function(){return Math.random().toString(36).substring(2,12)},y=function(){return Math.random().toString(36).substring(2,7)},g={utm_source:"source",utm_medium:"medium",utm_campaign:"campaign",utm_term:"term",utm_content:"content"},_={gclid:!0,fbclid:!0,dclid:!0};var b="__buildEnv__",w="__buildDate__",k="".concat("__buildVersion__","/").concat(b,"@").concat(w),P=316224e3,S=function(e,t){c().debug("Sending beacon",t);var n=new Blob([t],{type:"text/plain"});return navigator.sendBeacon(e,n),Promise.resolve()};var j=function(e,t){return console.log("Jitsu client tried to send payload to ".concat(e),function(e){if("string"==typeof e)try{return JSON.stringify(JSON.parse(e),null,2)}catch(t){return e}}(t)),Promise.resolve()},O=function(){function e(e,t){this.cookieDomain=e,this.cookieName=t}return e.prototype.save=function(e){f(this.cookieName,JSON.stringify(e),{domain:this.cookieDomain,secure:"http:"!==document.location.protocol,maxAge:P})},e.prototype.restore=function(){var e=h(this.cookieName);if(e)try{var t=JSON.parse(decodeURIComponent(e));return"object"!=typeof t?void c().warn("Can't restore value of ".concat(this.cookieName,"@").concat(this.cookieDomain,", expected to be object, but found ").concat("object"!=typeof t,": ").concat(t,". Ignoring")):t}catch(t){return void c().error("Failed to decode JSON from "+e,t)}},e.prototype.delete=function(){m(this.cookieName)},e}(),I=function(){function e(){}return e.prototype.save=function(e){},e.prototype.restore=function(){},e.prototype.delete=function(){},e}();var N={getSourceIp:function(){},describeClient:function(){return{referer:document.referrer,url:window.location.href,page_title:document.title,doc_path:document.location.pathname,doc_host:document.location.hostname,doc_search:window.location.search,screen_resolution:screen.width+"x"+screen.height,vp_size:Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)+"x"+Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),user_agent:navigator.userAgent,user_language:navigator.language,doc_encoding:document.characterSet}},getAnonymousId:function(e){var t=e.name,n=e.domain,o=h(t);if(o)return c().debug("Existing user id",o),o;var i=v();return c().debug("New user id",i),f(t,i,{domain:n,secure:"http:"!==document.location.protocol,maxAge:P}),i}};var A={getSourceIp:function(){},describeClient:function(){return{}},getAnonymousId:function(){return""}},E=function(){return N},C=function(){return A},x=function(e,t,n,o){void 0===o&&(o=function(e,t){});var i=new window.XMLHttpRequest;return new Promise((function(r,s){i.onerror=function(e){c().error("Failed to send",t,e),o(-1,{}),s(new Error("Failed to send JSON. See console logs"))},i.onload=function(){o(-1,{}),200!==i.status&&(c().warn("Failed to send data to ".concat(e," (#").concat(i.status," - ").concat(i.statusText,")"),t),s(new Error("Failed to send JSON. Error code: ".concat(i.status,". See logs for details")))),r()},i.open("POST",e),i.setRequestHeader("Content-Type","application/json"),Object.entries(n||{}).forEach((function(e){var t=e[0],n=e[1];return i.setRequestHeader(t,n)})),i.send(t),c().debug("sending json",t)}))},J=function(){function o(){this.userProperties={},this.permanentProperties={globalProps:{},propsPerEvent:{}},this.cookieDomain="",this.trackingHost="",this.idCookieName="",this.randomizeUrl=!1,this.apiKey="",this.initialized=!1,this._3pCookies={},this.cookiePolicy="keep",this.ipPolicy="keep",this.beaconApi=!1,this.transport=x,this.customHeaders=function(){return{}}}return o.prototype.id=function(t,n){return this.userProperties=e(e({},this.userProperties),t),c().debug("Jitsu user identified",t),this.userIdPersistence?this.userIdPersistence.save(t):c().warn("Id() is called before initialization"),n?Promise.resolve():this.track("user_identify",{})},o.prototype.rawTrack=function(e){return this.sendJson(e)},o.prototype.makeEvent=function(t,n,o){var r,s=o.env,a=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n}(o,["env"]);s||(s=i()?E():C()),this.restoreId();var c=this.getCtx(s),u=e(e({},this.permanentProperties.globalProps),null!==(r=this.permanentProperties.propsPerEvent[t])&&void 0!==r?r:{}),l=e({api_key:this.apiKey,src:n,event_type:t},a),p=s.getSourceIp();return p&&(l.source_ip=p),this.compatMode?e(e(e({},u),{eventn_ctx:c}),l):e(e(e({},u),c),l)},o.prototype._send3p=function(e,t,n){var o="3rdparty";n&&""!==n&&(o=n);var i=this.makeEvent(o,e,{src_payload:t});return this.sendJson(i)},o.prototype.sendJson=function(e){var t=this,n="keep"!==this.cookiePolicy?"&cookie_policy=".concat(this.cookiePolicy):"",o="keep"!==this.ipPolicy?"&ip_policy=".concat(this.ipPolicy):"",i="s2s"===this.apiKey.split(".")[0]?"/api/v1/s2s/event":"/api/v1/event",r="".concat(this.trackingHost).concat(i,"?token=").concat(this.apiKey).concat(n).concat(o);this.randomizeUrl&&(r="".concat(this.trackingHost,"/api.").concat(y(),"?p_").concat(y(),"=").concat(this.apiKey).concat(n).concat(o));var s=JSON.stringify(e);return c().debug("Sending payload to ".concat(r),s),this.transport(r,s,this.customHeaders(),(function(e,n){return t.postHandle(e,n)}))},o.prototype.postHandle=function(e,t){if("strict"===this.cookiePolicy||"comply"===this.cookiePolicy){if(200===e){var n=t;if("string"==typeof t&&(n=JSON.parse(t)),!n.delete_cookie)return}this.userIdPersistence.delete(),this.propsPersistance.delete(),m(this.idCookieName)}},o.prototype.getCtx=function(t){var n,o,i=new Date,r=t.describeClient()||{};return e(e({event_id:"",user:e({anonymous_id:"strict"!==this.cookiePolicy?t.getAnonymousId({name:this.idCookieName,domain:this.cookieDomain}):""},this.userProperties),ids:this._getIds(),utc_time:(n=i.toISOString(),o=n.split(".")[1],o?o.length>=7?n:n.slice(0,-1)+"0".repeat(7-o.length)+"Z":n),local_tz_offset:i.getTimezoneOffset()},r),function(e){var t={utm:{},click_id:{}};for(var n in e)if(e.hasOwnProperty(n)){var o=e[n],i=g[n];i?t.utm[i]=o:_[n]&&(t.click_id[n]=o)}return t}(function(e){if(!e)return{};for(var t=e.length>0&&"?"===e.charAt(0)?e.substring(1):e,n={},o=("?"===t[0]?t.substr(1):t).split("&"),i=0;i<o.length;i++){var r=o[i].split("=");n[decodeURIComponent(r[0])]=decodeURIComponent(r[1]||"")}return n}(r.doc_search)))},o.prototype._getIds=function(){if(!i())return{};for(var e=function(e){if(void 0===e&&(e=!1),e&&p)return p;var t=d(document.cookie);return p=t,t}(!1),t={},n=0,o=Object.entries(e);n<o.length;n++){var r=o[n],s=r[0],a=r[1];this._3pCookies[s]&&(t["_"==s.charAt(0)?s.substr(1):s]=a)}return t},o.prototype.track=function(e,t){var n=t||{};c().debug("track event of type",e,n);var o=this.makeEvent(e,this.compatMode?"eventn":"jitsu",t||{});return this.sendJson(o)},o.prototype.init=function(o){var r,l,p,d,h,f=this;if(i())o.fetch&&c().warn("Custom fetch implementation is provided to Jitsu. However, it will be ignored since Jitsu runs in browser"),this.transport=this.beaconApi?S:x;else{if(!o.fetch&&!globalThis.fetch)throw new Error("Jitsu runs in Node environment. However, neither JitsuOptions.fetch is provided, nor global fetch function is defined. \nPlease, provide custom fetch implementation. You can get it via node-fetch package");this.transport=(p=o.fetch||globalThis.fetch,function(o,i,r,s){return void 0===s&&(s=function(e,t){}),t(void 0,void 0,void 0,(function(){var t,a,u;return n(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,p(o,{method:"POST",headers:e({Accept:"application/json","Content-Type":"application/json"},r||{}),body:i})];case 1:return t=n.sent(),[3,3];case 2:throw a=n.sent(),c().error("Failed to send",i,a),s(-1,{}),new Error("Failed to send JSON. See console logs");case 3:if(200!==t.status)throw c().warn("Failed to send data to ".concat(o," (#").concat(t.status," - ").concat(t.statusText,")"),i),new Error("Failed to send JSON. Error code: ".concat(t.status,". See logs for details"));return[4,t.json()];case 4:return u=n.sent(),s(t.status,u),[2]}}))}))})}if(o.custom_headers&&"function"==typeof o.custom_headers?this.customHeaders=o.custom_headers:o.custom_headers&&(this.customHeaders=function(){return o.custom_headers}),"echo"===o.tracking_host&&(c().warn('jitsuClient is configured with "echo" transport. Outgoing requests will be written to console'),this.transport=j),o.ip_policy&&(this.ipPolicy=o.ip_policy),o.cookie_policy&&(this.cookiePolicy=o.cookie_policy),"strict"===o.privacy_policy&&(this.ipPolicy="strict",this.cookiePolicy="strict"),o.use_beacon_api&&navigator.sendBeacon&&(this.beaconApi=!0),"comply"===this.cookiePolicy&&this.beaconApi&&(this.cookiePolicy="strict"),o.log_level&&(d=o.log_level,(h=s[d.toLocaleUpperCase()])||(console.warn("Can't find log level with name ".concat(d.toLocaleUpperCase(),", defaulting to INFO")),h=s.INFO),a=u(h)),this.initialOptions=o,c().debug("Initializing Jitsu Tracker tracker",o,k),o.key){if(this.compatMode=void 0!==o.compat_mode&&!!o.compat_mode,this.cookieDomain=o.cookie_domain||function(){if(i())return window.location.hostname.replace("www.","")}(),this.trackingHost=function(e){for(;n="/",-1!==(t=e).indexOf(n,t.length-n.length);)e=e.substr(0,e.length-1);var t,n;return 0===e.indexOf("https://")||0===e.indexOf("http://")?e:"//"+e}(o.tracking_host||"t.jitsu.com"),this.randomizeUrl=o.randomize_url||!1,this.idCookieName=o.cookie_name||"__eventn_id",this.apiKey=o.key,"strict"===this.cookiePolicy?this.propsPersistance=new I:this.propsPersistance=i()?new O(this.cookieDomain,this.idCookieName+"_props"):new I,"strict"===this.cookiePolicy?this.userIdPersistence=new I:this.userIdPersistence=i()?new O(this.cookieDomain,this.idCookieName+"_usr"):new I,this.propsPersistance){var m=this.propsPersistance.restore();m&&(this.permanentProperties=m,this.permanentProperties.globalProps=null!==(r=m.globalProps)&&void 0!==r?r:{},this.permanentProperties.propsPerEvent=null!==(l=m.propsPerEvent)&&void 0!==l?l:{}),c().debug("Restored persistent properties",this.permanentProperties)}!1===o.capture_3rd_party_cookies?this._3pCookies={}:(o.capture_3rd_party_cookies||["_ga","_fbp","_ym_uid","ajs_user_id","ajs_anonymous_id"]).forEach((function(e){return f._3pCookies[e]=!0})),o.ga_hook&&c().warn("GA event interceptor isn't supported anymore"),o.segment_hook&&function(e){var t=window;t.analytics||(t.analytics=[]);e.interceptAnalytics(t.analytics)}(this),this.initialized=!0}else c().error("Can't initialize Jitsu, key property is not set")},o.prototype.interceptAnalytics=function(t){var n=this,o=function(t){var o;try{var i=e({},t.payload);c().debug("Intercepted segment payload",i.obj);var r=t.integrations["Segment.io"];if(r&&r.analytics){var s=r.analytics;"function"==typeof s.user&&s.user()&&"function"==typeof s.user().id&&(i.obj.userId=s.user().id())}(null===(o=null==i?void 0:i.obj)||void 0===o?void 0:o.timestamp)&&(i.obj.sentAt=i.obj.timestamp);var a=t.payload.type();"track"===a&&(a=t.payload.event()),n._send3p("ajs",i,a)}catch(e){c().warn("Failed to send an event",e)}t.next(t.payload)};"function"==typeof t.addSourceMiddleware?(c().debug("Analytics.js is initialized, calling addSourceMiddleware"),t.addSourceMiddleware(o)):(c().debug("Analytics.js is not initialized, pushing addSourceMiddleware to callstack"),t.push(["addSourceMiddleware",o])),t.__en_intercepted=!0},o.prototype.restoreId=function(){if(this.userIdPersistence){var t=this.userIdPersistence.restore();t&&(this.userProperties=e(e({},t),this.userProperties))}},o.prototype.set=function(t,n){var o,i=null==n?void 0:n.eventType,r=void 0===(null==n?void 0:n.persist)||(null==n?void 0:n.persist);if(void 0!==i){var s=null!==(o=this.permanentProperties.propsPerEvent[i])&&void 0!==o?o:{};this.permanentProperties.propsPerEvent[i]=e(e({},s),t)}else this.permanentProperties.globalProps=e(e({},this.permanentProperties.globalProps),t);this.propsPersistance&&r&&this.propsPersistance.save(this.permanentProperties)},o.prototype.unset=function(e,t){r();var n=null==t?void 0:t.eventType,o=void 0===(null==t?void 0:t.persist)||(null==t?void 0:t.persist);n?this.permanentProperties.propsPerEvent[n]&&delete this.permanentProperties.propsPerEvent[n][e]:delete this.permanentProperties.globalProps[e],this.propsPersistance&&o&&this.propsPersistance.save(this.permanentProperties)},o}();var T=["use_beacon_api","cookie_domain","tracking_host","cookie_name","key","ga_hook","segment_hook","randomize_url","capture_3rd_party_cookies","id_method","log_level","compat_mode","privacy_policy","cookie_policy","ip_policy","custom_headers"];var R="data-suppress-interception-warning";function z(e){return"\n      ATTENTION! ".concat(e,"-hook set to true along with defer/async attribute! If ").concat(e," code is inserted right after Jitsu tag,\n      first tracking call might not be intercepted! Consider one of the following:\n       - Inject jitsu tracking code without defer/async attribute\n       - If you're sure that events won't be sent to ").concat(e," before Jitsu is fully initialized, set ").concat(R,'="true"\n       script attribute\n    ')}function H(e,t){c().debug("Processing queue",e);for(var n=0;n<e.length;n+=1){var i=o([],e[n],!0)||[],r=i[0],s=i.slice(1),a=t[r];"function"==typeof a&&a.apply(t,s)}e.length=0}if(window){var D=window,F=function(e){var t=document.currentScript||document.querySelector("script[src*=jsFileName][data-jitsu-api-key]");if(t){var n,o={tracking_host:(n=t.getAttribute("src"),n.replace("/s/lib.js","").replace("/lib.js","")),key:null};T.forEach((function(e){var n="data-"+e.replace("_","-");if(void 0!==t.getAttribute(n)&&null!==t.getAttribute(n)){var i=t.getAttribute(n);"true"===i?i=!0:"false"===i&&(i=!1),o[e]=i}})),e.jitsuClient=function(e){var t=new J;return t.init(e),t}(o),!o.segment_hook||null===t.getAttribute("defer")&&null===t.getAttribute("async")||null!==t.getAttribute(R)||c().warn(z("segment")),!o.ga_hook||null===t.getAttribute("defer")&&null===t.getAttribute("async")||null!==t.getAttribute(R)||c().warn(z("ga"));var i=function(){var t=e.jitsuQ=e.jitsuQ||[];t.push(arguments),H(t,e.jitsuClient)};return e.jitsu=i,"true"!==t.getAttribute("data-init-only")&&"yes"!==t.getAttribute("data-init-only")&&i("track","pageview"),e.jitsuClient}c().warn("Jitsu script is not properly initialized. The definition must contain data-jitsu-api-key as a parameter")}(D);F?(c().debug("Jitsu in-browser tracker has been initialized"),D.jitsu=function(){var e=D.jitsuQ=D.jitsuQ||[];e.push(arguments),H(e,F)},D.jitsuQ&&(c().debug("Initial queue size of ".concat(D.jitsuQ.length," will be processed")),H(D.jitsuQ,F))):c().error("Jitsu tracker has not been initialized (reason unknown)")}else c().warn("Jitsu tracker called outside browser context. It will be ignored")}();
